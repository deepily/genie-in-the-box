<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.1/socket.io.js"></script>

<script>

    var audioContext = null;

    function createAudioContext() {

        // Check if the AudioContext is already created
        if ( window.AudioContext || window.webkitAudioContext ) {
            audioContext = new ( window.AudioContext || window.webkitAudioContext )();
            console.log( "AudioContext created!" );
        } else {
            console.log( "AudioContext is not supported in this browser" );
        }
    }

    // Call createAudioContext() when the webpage is loaded and DOM is available
    document.addEventListener( "DOMContentLoaded", function() {
        createAudioContext();
    } );

    var socket = io();
    socket.on( "connect", function() {
        console.log( "Connected to Flask server" );
    } );

    function updateClock( date ) {
        document.getElementById( "clock" ).innerHTML = "Current time [" + date + "]";
    }

    socket.on( "time_update", function( data ) {
        var date = data.date;
        // document.getElementById("queue-state").innerHTML = "Time [" + date + "]";
        updateClock( date )
    } );
    socket.on( "todo_update", function( data ) {
        document.getElementById( "todo" ).innerHTML = "Jobs TODO [" + data.value + "]";
    } );
    socket.on( "done_update", function( data ) {
        document.getElementById( "done" ).innerHTML = "Jobs DONE [" + data.value + "]";
    } );
    // socket.on("no_change", function(data) {
    //     // console.log("No change. Queue still the same size: " + data.value + ", Date: " + data.date);
    //     updateClock( data.date )
    // });

    socket.on( "audio_update", function( data ) {

        var source = audioContext.createBufferSource();
        fetch( data.audioURL )
            .then( response => response.arrayBuffer() )
            .then( arrayBuffer => audioContext.decodeAudioData( arrayBuffer ) )
            .then( audioBuffer => {
                source.buffer = audioBuffer;
                source.connect( audioContext.destination );
                source.start();
            } )
            .catch( error => {
                console.log( "Error loading audio file:", error );
            } );
    } );

</script>

<h1 id="clock"></h1>
<h1 id="todo">Jobs todo [0]</h1>
<h1 id="done">Jobs done [0]</h1>
<a href="#" onclick="createAudioContext(); return false;">Enable audio playback</a>

</body>
</html>




